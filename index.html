<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loan Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
form{position:relative;background:#fff;padding:20px;border-radius:10px;max-width:430px;margin:auto;box-shadow:0 0 10px rgba(0,0,0,.1)}
label{font-weight:bold;margin-top:12px;display:block}
input,select,textarea,button{
  width:100%;height:42px;padding:8px 10px;margin-top:5px;
  border-radius:6px;border:1px solid #ccc;box-sizing:border-box;background:#fff
}
textarea{resize:none}
button{background:#007bff;color:#fff;border:none;margin-top:15px;cursor:pointer}

/* 3-dot menu */
.menu-container{position:absolute;top:12px;left:12px}
.menu-btn{
  width:36px;height:36px;border:1px solid #ccc;border-radius:6px;
  background:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer
}
.menu-dropdown{
  display:none;position:absolute;top:46px;left:0;background:#fff;
  border-radius:6px;min-width:230px;box-shadow:0 4px 12px rgba(0,0,0,.25)
}
.menu-container:hover .menu-dropdown{display:block}
.menu-dropdown a{
  display:block;padding:12px 14px;text-decoration:none;color:#000;border-bottom:1px solid #eee
}
.menu-dropdown a:hover{background:#f0f0f0}

/* Cash */
#denominations{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.denom-card{border:1px solid #d0d0d0;border-radius:12px;padding:10px;text-align:center}
.denom{font-size:18px;font-weight:700;margin-bottom:6px}
.amount-cash{background:#f0f0f0!important}

/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center}
.modal-box{background:#fff;width:92%;max-width:420px;border-radius:12px;padding:16px}
.modal-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
.modal-card{border:1px solid #ccc;border-radius:10px;padding:8px;text-align:center;font-weight:700}
.modal-actions{display:flex;gap:12px;margin-top:16px}
.cancel{background:#ccc;color:#000}
.confirm{background:#007bff;color:#fff}
</style>
</head>

<body>

<form id="loanForm">

<div class="menu-container">
  <div class="menu-btn">⋮</div>
  <div class="menu-dropdown">
    <a href="https://oprasannakumar.github.io/Financial-Transaction/">Financial Entries</a>
    <a href="https://oprasannakumar.github.io/SelfTransfer/">Self Transfer</a>
    <a href="https://oprasannakumar.github.io/LoanTransfer/">Loan Entries</a>
  </div>
</div>

<h2 style="text-align:center">Loan Entry</h2>

<label>Date</label>
<input type="date" id="date">

<label>Borrower</label>
<select id="borrower">
  <option value="">Select</option>
  <option>Chinnama</option>
  <option>Grand Father</option>
  <option>Mother</option>
  <option>Pedhamma</option>
  <option>Ravi Babai</option>
  <option>Srinivas Babai</option>
  <option>Vasavi</option>
  <option value="Other">Other</option>
</select>

<input id="borrowerOther" placeholder="Enter borrower name" style="display:none">

<label>Narration</label>
<textarea id="narration"></textarea>

<label>Given / Received</label>
<select id="direction">
  <option value="">Select</option>
  <option>Given</option>
  <option>Received</option>
</select>

<label>Transaction Type</label>
<select id="trtype">
  <option value="">Select</option>
  <option value="cash">Cash</option>
  <option>UPI</option>
  <option>NET</option>
  <option>DEBIT</option>
  <option>CREDIT</option>
</select>

<label id="accountLabel" style="display:none">Account</label>
<select id="account" style="display:none"></select>

<div id="denominationsBox" style="display:none">
  <h3>Cash Denominations</h3>
  <div id="denominations"></div>
</div>

<label>Amount</label>
<input type="number" id="amount">

<button type="submit">Submit</button>
</form>

<!-- Modal -->
<div class="modal" id="confirmModal">
  <div class="modal-box">
    <h3>Confirm Loan Entry</h3>
    <div id="confirmText"></div>
    <div id="confirmDenoms"></div>
    <div class="modal-actions">
      <button class="cancel" onclick="closeModal()">Cancel</button>
      <button class="confirm" onclick="finalSubmit()">Confirm</button>
    </div>
  </div>
</div>

<script>
const WEBHOOK_URL = "https://hook.eu1.make.com/uayw6m2h1u56gz1fuhnyewvh860q8tjy";

const bankAccounts=["FI","HDFC Old","HDFC New","ICICI","IndusInd","Kotak","RBL","SBI"];
const creditCards=["Axis Flipkart","Axis MyZone","Axis Neo","HDFC Millennia","ICICI Amazon","SBI BPCL"];
const denoms=[500,200,100,50,20,10,5,2,1];

const denomWrap=document.getElementById("denominations");
const amount=document.getElementById("amount");

/* Build denominations */
denoms.forEach(d=>{
  denomWrap.innerHTML+=`
    <div class="denom-card">
      <div class="denom">₹${d}</div>
      <input type="number" data-denom="${d}" value="0" min="0">
    </div>`;
});

/* Borrower other */
borrower.onchange=()=>borrowerOther.style.display=
  borrower.value==="Other"?"block":"none";

/* Account setup */
function setupAccount(){
  if(!trtype.value||trtype.value==="cash"){
    account.style.display=accountLabel.style.display="none";
    account.innerHTML="";
    return;
  }
  const list=["UPI","NET","DEBIT"].includes(trtype.value)
    ? bankAccounts : creditCards;

  account.innerHTML='<option value="">Select</option>';
  list.forEach(v=>account.innerHTML+=`<option>${v}</option>`);
  account.style.display=accountLabel.style.display="block";
}

/* Cash toggle */
function toggleCash(){
  if(trtype.value==="cash"){
    denominationsBox.style.display="block";
    amount.readOnly=true;
    amount.classList.add("amount-cash");
  }else{
    denominationsBox.style.display="none";
    amount.readOnly=false;
    amount.classList.remove("amount-cash");
    amount.value="";
    document.querySelectorAll("[data-denom]").forEach(i=>i.value=0);
  }
}

/* Auto sum */
document.addEventListener("input",e=>{
  if(e.target.dataset?.denom){
    let total=0;
    document.querySelectorAll("[data-denom]").forEach(i=>{
      total+=Number(i.dataset.denom)*(Number(i.value)||0);
    });
    amount.value=total;
  }
});

trtype.onchange=()=>{setupAccount();toggleCash();};

/* Submit */
loanForm.onsubmit=e=>{
  e.preventDefault();

  const miss=[];
  if(!date.value) miss.push("Date");
  if(!borrower.value) miss.push("Borrower");
  if(borrower.value==="Other"&&!borrowerOther.value) miss.push("Borrower Name");
  if(!narration.value) miss.push("Narration");
  if(!direction.value) miss.push("Given / Received");
  if(!trtype.value) miss.push("Transaction Type");
  if(trtype.value!=="cash"&&!account.value) miss.push("Account");
  if(!amount.value||amount.value<=0) miss.push("Amount");

  if(miss.length){
    alert("Please fill:\n\n• "+miss.join("\n• "));
    return;
  }

  confirmText.innerHTML=`
    <p><b>Date:</b> ${date.value}</p>
    <p><b>Borrower:</b> ${borrower.value==="Other"?borrowerOther.value:borrower.value}</p>
    <p><b>Direction:</b> ${direction.value}</p>
    <p><b>Transaction:</b> ${trtype.value==="cash"?"Cash":trtype.value+" - "+account.value}</p>
    <p><b>Amount:</b> ₹${amount.value}</p>
  `;

  confirmDenoms.innerHTML="";
  if(trtype.value==="cash"){
    confirmDenoms.innerHTML='<h4>Cash Denominations</h4><div class="modal-grid"></div>';
    const g=confirmDenoms.querySelector(".modal-grid");
    denoms.forEach(d=>{
      const v=document.querySelector(`[data-denom="${d}"]`).value || 0;
      g.innerHTML+=`<div class="modal-card">₹${d}<br>${v}</div>`;
    });
  }

  confirmModal.style.display="flex";
};

function closeModal(){confirmModal.style.display="none"}

function finalSubmit(){
  const data={
    date:date.value,
    borrower:borrower.value==="Other"?borrowerOther.value:borrower.value,
    narration:narration.value,
    direction:direction.value,
    transactionType:trtype.value,
    account:trtype.value==="cash"?"Cash":account.value,
    amount:Number(amount.value),
    denominations:denoms.map(d=>({
      denomination:d,
      count:Number(document.querySelector(`[data-denom="${d}"]`).value||0)
    }))
  };

  fetch(WEBHOOK_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(data)
  }).catch(err=>console.error("Webhook failed",err));

  closeModal();
  alert("Loan entry saved successfully");
  loanForm.reset();
  denominationsBox.style.display="none";
  amount.classList.remove("amount-cash");
}
</script>

</body>
</html>