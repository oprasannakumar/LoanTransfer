<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monthly Transaction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
form{background:#fff;padding:20px;border-radius:8px;max-width:450px;margin:auto;box-shadow:0 0 10px rgba(0,0,0,.1)}
label{font-weight:bold;margin-top:10px;display:block}
input,select,button{
  width:100%;height:42px;padding:8px;margin-top:5px;
  border-radius:4px;border:1px solid #ccc;box-sizing:border-box
}
button{background:#007bff;color:#fff;border:none;margin-top:15px}
button:hover{background:#0056b3}
hr{margin:20px 0}

/* Payment rows */
.payment-row{
  border:1px solid #ddd;
  padding:10px;
  border-radius:6px;
  margin-top:10px
}
.row{
  display:flex;
  gap:6px
}
.row select,.row input{flex:1}
.remove-btn{
  background:#dc3545;
  height:42px
}
.add-btn{
  background:#28a745
}
.total{
  font-weight:bold;
  margin-top:10px;
  text-align:right
}
</style>
</head>

<body>

<form id="form">

<h2 style="text-align:center">Monthly Transaction</h2>

<label>Date</label>
<input type="date" id="date">

<label>Narration</label>
<input id="narration">

<label>Bill No</label>
<input id="billNo">

<label>Purpose</label>
<input id="purpose">

<label>Spent For / Earned By</label>
<input id="spentFor">

<label>Transaction Flow</label>
<select id="flow">
  <option value="">Select</option>
  <option value="withdraw">Withdraw</option>
  <option value="deposit">Deposit</option>
</select>

<label>Total Amount</label>
<input type="number" id="totalAmount">

<hr>
<h3>Payment Split</h3>

<div id="payments"></div>

<button type="button" class="add-btn" onclick="addPayment()">➕ Add Payment</button>

<div class="total">Paid Total: ₹<span id="paidTotal">0</span></div>

<button type="submit">Submit</button>

</form>

<script>
const bankAccounts=["FI","HDFC","ICICI","SBI"];
const creditCards=["HDFC Tata Neu","ICICI Amazon","Axis Flipkart"];
const rewards=["AMAZON","PHONEPE","FLIPKART"];

function addPayment(){
  const div=document.createElement("div");
  div.className="payment-row";
  div.innerHTML=`
    <div class="row">
      <select class="ptype">
        <option value="">Type</option>
        <option>CASH</option>
        <option>UPI</option>
        <option>DEBIT</option>
        <option>CREDIT</option>
        <option>REWARDS</option>
      </select>
      <select class="pfrom"></select>
      <input type="number" class="pamt" placeholder="Amount">
      <button type="button" class="remove-btn" onclick="this.parentElement.parentElement.remove();calc()">✖</button>
    </div>
  `;
  document.getElementById("payments").appendChild(div);

  const type=div.querySelector(".ptype");
  const from=div.querySelector(".pfrom");

  type.onchange=()=>{
    from.innerHTML="<option value=''>From/To</option>";
    let list=[];
    if(["UPI","DEBIT"].includes(type.value)) list=bankAccounts;
    if(type.value==="CREDIT") list=creditCards;
    if(type.value==="REWARDS") list=rewards;
    if(type.value==="CASH"){ from.innerHTML="<option>Cash</option>"; return; }
    list.forEach(v=>from.innerHTML+=`<option>${v}</option>`);
  };

  div.querySelector(".pamt").oninput=calc;
}

function calc(){
  let t=0;
  document.querySelectorAll(".pamt").forEach(i=>t+=Number(i.value)||0);
  document.getElementById("paidTotal").innerText=t;
}

addPayment(); // default row

form.onsubmit=async e=>{
  e.preventDefault();

  const total=Number(totalAmount.value);
  const paid=Number(paidTotal.innerText);

  if(!date.value||!narration.value||!flow.value||!total){
    alert("Fill all mandatory fields");
    return;
  }

  if(total!==paid){
    alert("Split payment total must equal Total Amount");
    return;
  }

  const payments=[];
  document.querySelectorAll(".payment-row").forEach(r=>{
    payments.push({
      trtype:r.querySelector(".ptype").value,
      from_to:r.querySelector(".pfrom").value,
      amount:r.querySelector(".pamt").value
    });
  });

  await fetch("https://hook.eu1.make.com/uayw6m2h1u56gz1fuhnyewvh860q8tjy",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      category:"monthly_transaction",
      date:date.value,
      narration:narration.value,
      bill_no:billNo.value,
      purpose:purpose.value,
      spent_for:spentFor.value,
      flow_type:flow.value,
      total_amount:total,
      payments:payments
    })
  });

  alert("Transaction saved");
  form.reset();
  document.getElementById("payments").innerHTML="";
  addPayment();
  calc();
};
</script>

</body>
</html>